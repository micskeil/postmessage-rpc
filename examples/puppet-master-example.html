<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Puppet Master Example</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            margin-bottom: 10px;
            color: #fff;
        }
        .subtitle {
            color: #999;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .controls {
            background: #16213e;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .control-section {
            margin-bottom: 25px;
        }
        .control-section:last-child {
            margin-bottom: 0;
        }
        .control-section h3 {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .direction-pad {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            gap: 10px;
            margin-bottom: 20px;
        }
        .direction-pad button {
            background: #0f3460;
            border: 2px solid #533483;
            border-radius: 10px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .direction-pad button:hover:not(:disabled) {
            background: #533483;
            transform: scale(1.05);
        }
        .direction-pad button:active:not(:disabled) {
            transform: scale(0.95);
        }
        .direction-pad button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .btn-up { grid-column: 2; grid-row: 1; }
        .btn-left { grid-column: 1; grid-row: 2; }
        .btn-down { grid-column: 2; grid-row: 3; }
        .btn-right { grid-column: 3; grid-row: 2; }

        .control-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        .control-row label {
            min-width: 80px;
            font-size: 14px;
        }
        input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        input[type="range"] {
            flex: 1;
            max-width: 300px;
        }
        .size-value {
            min-width: 50px;
            text-align: right;
            font-weight: bold;
            color: #fff;
        }
        button.action-btn {
            background: #e94560;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        button.action-btn:hover {
            background: #c23b52;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.4);
        }
        .stats {
            background: #16213e;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .stats h3 {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .stat-item {
            background: #0f3460;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #533483;
        }
        .stat-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .alert {
            background: #e94560;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 10px;
        }
        .alert.show {
            display: flex;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        #plugin-container {
            display: none;
        }
        .keyboard-hint {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔊 Puppet Master Demo</h1>
        <p class="subtitle">
            Control the puppet in the plugin iframe using the controls below.
            Watch the position update in real-time!
        </p>

        <div class="alert" id="alert">
            <span id="alert-text"></span>
        </div>

        <div class="stats">
            <h3>🔊 Live Stats</h3>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-label">Position X</div>
                    <div class="stat-value" id="stat-x">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Position Y</div>
                    <div class="stat-value" id="stat-y">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total Moves</div>
                    <div class="stat-value" id="stat-moves">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Boundary Hits</div>
                    <div class="stat-value" id="stat-hits">0</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-section">
                <h3>🔊ï Movement Controls</h3>
                <div class="direction-pad">
                    <button class="btn-up" id="btn-up">✬ï</button>
                    <button class="btn-left" id="btn-left">✬ï</button>
                    <button class="btn-down" id="btn-down">✬ï</button>
                    <button class="btn-right" id="btn-right">✞ï</button>
                </div>
                <div class="keyboard-hint">
                    🔊 Tip: Use arrow keys on your keyboard for easier control
                </div>
            </div>

            <div class="control-section">
                <h3>🔊 Appearance</h3>
                <div class="control-row">
                    <label>Color:</label>
                    <input type="color" id="color-picker" value="#ff6b6b">
                </div>
                <div class="control-row">
                    <label>Size:</label>
                    <input type="range" id="size-slider" min="30" max="150" value="60">
                    <span class="size-value"><span id="size-value">60</span>px</span>
                </div>
            </div>

            <div class="control-section">
                <h3>✚ï Actions</h3>
                <button class="action-btn" id="btn-reset">🔊 Reset Position</button>
                <button class="action-btn" id="btn-show" style="background: #533483; margin-left: 10px;">✖ï Show Plugin</button>
            </div>
        </div>
    </div>

    <div id="plugin-container"></div>

    <script type="module">
        const initExampleSdk = (await import("./initExampleSdk.ts")).default;

        let plugin;
        let moveCount = 0;
        let hitCount = 0;
        let isPluginVisible = false;

        const sdk = await initExampleSdk({ settings: {} });

        // Initialize plugin
        plugin = await sdk.initPuppetMasterPlugin(
            {
                data: {},
                settings: {
                    background: "#667eea"
                },
                parentCallbacks: {
                    onPositionChanged: async (x, y) => {
                        document.getElementById("stat-x").textContent = x;
                        document.getElementById("stat-y").textContent = y;
                    },
                    onBoundaryHit: async (edge) => {
                        hitCount++;
                        document.getElementById("stat-hits").textContent = hitCount;
                        showAlert(`🔊 Hit ${edge} boundary!`);
                    }
                }
            },
            {}
        );

        function showAlert(message) {
            const alert = document.getElementById("alert");
            const alertText = document.getElementById("alert-text");
            alertText.textContent = message;
            alert.classList.add("show");
            setTimeout(() => {
                alert.classList.remove("show");
            }, 2000);
        }

        async function move(direction) {
            moveCount++;
            document.getElementById("stat-moves").textContent = moveCount;
            await plugin.methods.move(direction);
        }

        // Direction buttons
        document.getElementById("btn-up").onclick = () => move("up");
        document.getElementById("btn-down").onclick = () => move("down");
        document.getElementById("btn-left").onclick = () => move("left");
        document.getElementById("btn-right").onclick = () => move("right");

        // Keyboard controls
        document.addEventListener("keydown", (e) => {
            if (!isPluginVisible) return;

            switch (e.key) {
                case "ArrowUp":
                    e.preventDefault();
                    move("up");
                    break;
                case "ArrowDown":
                    e.preventDefault();
                    move("down");
                    break;
                case "ArrowLeft":
                    e.preventDefault();
                    move("left");
                    break;
                case "ArrowRight":
                    e.preventDefault();
                    move("right");
                    break;
            }
        });

        // Color picker
        document.getElementById("color-picker").addEventListener("input", async (e) => {
            await plugin.methods.setColor(e.target.value);
        });

        // Size slider
        document.getElementById("size-slider").addEventListener("input", async (e) => {
            const size = e.target.value;
            document.getElementById("size-value").textContent = size;
            await plugin.methods.setSize(parseInt(size));
        });

        // Reset button
        document.getElementById("btn-reset").onclick = async () => {
            moveCount = 0;
            hitCount = 0;
            document.getElementById("stat-moves").textContent = moveCount;
            document.getElementById("stat-hits").textContent = hitCount;
            document.getElementById("color-picker").value = "#ff6b6b";
            document.getElementById("size-slider").value = 60;
            document.getElementById("size-value").textContent = 60;
            await plugin.methods.reset();
            showAlert("🔊 Puppet reset to center!");
        };

        // Show/Hide plugin
        const btnShow = document.getElementById("btn-show");
        btnShow.onclick = () => {
            if (isPluginVisible) {
                plugin.hide();
                btnShow.textContent = "✖ï Show Plugin";
                isPluginVisible = false;
            } else {
                plugin.show();
                btnShow.textContent = "✏ï Hide Plugin";
                isPluginVisible = true;
            }
        };
    </script>
</body>
</html>
